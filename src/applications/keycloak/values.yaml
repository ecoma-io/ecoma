postgresql:
  fullnameOverride: postgresql
  architecture: standalone
  auth:
    username: keycloak  
    database: keycloak
    existingSecret: keycloak-secret
    secretKeys:
      adminPasswordKey: postgresql-admin-password
      userPasswordKey: postgresql-password
      replicationPasswordKey: postgresql-replication-password
  primary:    
    nodeSelector: 
      kubernetes.io/hostname: node1
    persistence:
      size: 1Gi
      storageClass: local-path
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 750m
        memory: 768Mi

keycloak:
  fullnameOverride: keycloak
  nodeSelector: 
    kubernetes.io/hostname: node1
  auth:
    adminUser: "admin"
    existingSecret: keycloak-secret
    passwordSecretKey: ""  
  postgresql:
    enabled: false
  externalDatabase:
    existingSecret: keycloak-secret  
    existingSecretHostKey: postgresql-host
    existingSecretPortKey: postgresql-port
    existingSecretUserKey: postgresql-username
    existingSecretDatabaseKey: postgresql-database
    existingSecretPasswordKey: postgresql-password
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 750m
      memory: 768Mi
  adminRealm: "ecoma"
  proxy: edge
  keycloakConfigCli:
    enabled: true
    configuration: 
      master.json: |
        {
          "realm" : "master",
          "attributes": {
            "frontendUrl": https://keycloak.ecoma.io
          }
        }
      ecoma.json: |
        {
          "realm": "ecoma",
          "displayName": "Ecoma",
          "enabled": true,
          "identityProviders": [
            {
              "alias": "google",
              "providerId": "google",
              "config": {
                "clientId": "${GOOGLE_CLIENT_ID}",
                "clientSecret": "${GOOGLE_CLIENT_SECRET}"
              }
            },
            {
              "alias": "github",
              "providerId": "github",
              "config": {
                "clientId": "${GITHUB_CLIENT_ID}",
                "clientSecret": "${GITHUB_CLIENT_SECRET}"
              }
            }
          ],
          "groups": [
            { "name": "admins" },
            { "name": "devops" },
            { "name": "developers" }
          ],
          "users": [
            {
              "username": "${ADMIN_USERNAME}",
              "email": "${ADMIN_EMAIL}",
              "enabled": true,
              "emailVerified": true,
              "requiredActions": [],
              "credentials": [],
              "federatedIdentities": [
                {
                  "identityProvider": "google",
                  "userId": "${ADMIN_EMAIL}",
                  "userName": "${ADMIN_USERNAME}"
                },
                {
                  "identityProvider": "github",
                  "userId": "${ADMIN_EMAIL}",
                  "userName": "${ADMIN_USERNAME}"
                }
              ],
              "realmRoles": ["offline_access", "uma_authorization"],
              "clientRoles": {
                "realm-management": ["realm-admin"],
                "security-admin-console": ["admin"],
                "master-realm": ["admin"]
              }
            }
          ],
        }
    extraEnvVars:
      - name: ADMIN_EMAIL
        value: ${ADMIN_EMAIL}
      - name: ADMIN_USERNAME
        value: ${ADMIN_USERNAME}
      - name: GOOGLE_CLIENT_ID
        valueFrom:
          secretKeyRef:
            name: keycloak-secret
            key: google-client-id
      - name: GOOGLE_CLIENT_SECRET
        valueFrom:
          secretKeyRef:
            name: keycloak-secret
            key: google-client-secret
      - name: GITHUB_CLIENT_ID
        valueFrom:
          secretKeyRef:
            name: keycloak-secret
            key: github-client-id
      - name: GITHUB_CLIENT_SECRET
        valueFrom:
          secretKeyRef:
            name: keycloak-secret
            key: github-client-secret
  ingress:
    enabled: true
    ingressClassName: traefik
    hostname: iam.ecoma.io
  adminIngress:
    enabled: true
    ingressClassName: traefik
    hostname: keycloak.ecoma.io   